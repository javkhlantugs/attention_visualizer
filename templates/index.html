{% extends "base.html" %}
{% block content %}
<div id="loading">
    <img id="loading-image" src="{{ url_for('static', filename='images/Settings.gif') }}" alt="Loading..." />
</div>
<div class="grid row-gap-3" style="height: 100vh;">
        <div class="row align-items-center justify-content-md-center" style="height:50vh">
            <div class="align-middle">
                <p class="fs-1 fw-bold text-center">Let's use Google's BERT model and Hugging Face's transformers library to predict a masked
                            word within a sentence</p>
            </div>

        </div>
        <div class="row justify-content-md-center align-items-start">

            <div class="">
                <div class="input-group input-group-lg">
                    <input id="sentence" name="sentence" type="text" class="form-control" placeholder="Type a sentence"
                        aria-label="Recipient's username with two button addons">
                    <button id="generateButton" class="btn btn-outline-secondary" type="button">Tokenize</button>
                </div>
                <div id="wordButtons" class="btn-group mt-2"></div>

                <h3 class="mt-3">Steps</h3>
                    <ol class="list-group">
                        <li class="list-group-item" style="border: none">1. Type a sentence and click tokenize</li>
                        <li class="list-group-item" style="border: none">2. Click on a word you'd like to hide</li>
                    </ol>
        </div>
    </div>
    </div>
    <div class="row align-items-center justify-content-md-center" style="height: 100vh">
        <p class="fs-4">
        One way to create language models is to build a Masked Language Model, where a language model is trained to predict a
        “masked” word that is missing from a sequence of text. BERT is a transformer-based language model developed by Google,
        and it was trained with this approach: the language model was trained to predict a masked word based on the surrounding
        context words.
        </p>
        <p class="fs-4">
            One way to create language models is to build a Masked Language Model, where a language model is trained to predict
            a
            “masked” word that is missing from a sequence of text. BERT is a transformer-based language model developed by
            Google,
            and it was trained with this approach: the language model was trained to predict a masked word based on the
            surrounding
            context words.
        </p>
        <p class="fs-4">
            After submitting your sentence with a hidden word, the result page will show two things:
        </p>
        <ul class="fs-4 fw-bold">
            <li>Three complete sentences with predicted words with the highest ranks.</li>
            <li>diagrams visualizing attention scores, with one diagram generated for each of the 144 attention heads.</li>
        </ul>
</div>
<script>
     // Declare a global variable to store the original input sentence
    let wordsArray = [];


    //function that loads the loader circle gif when one of the word buttons are clicked
    $(document).ready(function () {
            console.log("loading circle loader function working")
            // Attach a click event handler to a parent element containing the buttons
            $(document).on('click', '.loading-circle', function () {
                // Show the loading element when any button is clicked
                $('#loading').show();

                // Perform any additional actions or navigate to the next page here
            });
        });

    //function that hides the loading cirle gif after a page loads    
    $(window).on('load', function () { $('#loading').hide(); })


    document.addEventListener("DOMContentLoaded", function () {
            // Find the button element by its ID
            const generateButton = document.getElementById("generateButton");

            // Add a click event listener to the button
            generateButton.addEventListener("click", createWordButtons);

            // Add a keypress event listener to the button
            document.addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
                createWordButtons();
            }
        });
        });

    function createWordButtons() {
            const inputSentence = document.getElementById("sentence").value;
            wordsArray = inputSentence.split(" ");
            const wordButtonsContainer = document.getElementById("wordButtons");

            // Clear previous content in the wordButtonsContainer
            wordButtonsContainer.innerHTML = "";

            wordsArray.forEach((word) => {
                const wordButton = document.createElement("button");
                wordButton.textContent = word;

                //// Add a class to the button for the purpose of triggering loading page while js sends API data to the backend
                wordButton.classList.add("btn");
                wordButton.classList.add("btn-outline-dark")
                wordButton.classList.add("loading-circle")
                wordButton.type = "button"
                // Add a click event listener to each word button
                wordButton.addEventListener("click", () => {
                    // Handle the click event (e.g., show an alert)
                    maskWord(word);
                });

                // Append the word button to the container
                wordButtonsContainer.appendChild(wordButton);
            });
        }

        function maskWord(clickedWord){
            // Find the index of the clicked word in the global wordsArray
            const index = wordsArray.indexOf(clickedWord);

            if (index !== -1) {
                // Replace the clicked word with "[MASK]"
                wordsArray[index] = "[MASK]";
            }

            // Display the updated sentence
            const updatedSentence = wordsArray.join(" ");
            console.log("Updated Sentence:", updatedSentence);

            // Send the updatedSentence to the Flask backend
            sendToBackend(updatedSentence);
        }

        function sendToBackend(updatedSentence) {
                // Define the URL of your Flask backend
                const apiUrl = "http://127.0.0.1:5000/api";

                // Define the data to send in the POST request
                const data = { updatedSentence };

                // Define the options for the fetch request
                const requestOptions = {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(data)
                };

                // Send the POST request to the Flask backend
                 fetch(apiUrl, requestOptions)
                    .then(() => {
                        // The request is sent, and you don't need to process the response
                        console.log("POST request sent to Flask backend.");
                    })
                    .then(data => {
                         console.log("Loading result:");
                         window.location.href = "/result";
                     })

                    .catch(error => {
                        console.error("Error:", error);
                    });
            }
</script>
{% endblock %}
```